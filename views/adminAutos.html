<style>
    #productTable { width: auto; }
    #productTable td { max-width: 150px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; }
    #productTable td input { max-width: 125px; }
</style>

<div ng-controller="autoCtrl">
    <div id="loader-wrapper" ng-if="loading">
        <div id="loader"></div>
    </div>
    <div class="alert alert-success" id="alert" style="position:fixed;bottom:0;right:0;display:none;">
        <button type="button" class="close" data-dismiss="alert">x</button>
        <strong>Поздравляем! </strong>
        Вы добавили новый автомобиль
    </div>
    <div class="alert alert-success" id="a-auto-edit" style="position:fixed;bottom:0;right:0;display:none;">
        <button type="button" class="close" data-dismiss="alert">x</button>
        <strong>Поздравляем! </strong>
        Вы обновили {{updatedAuto.name}}
    </div>
    <div class="alert alert-danger" id="a-auto-delete" style="position:fixed;bottom:0;right:0;display:none;">
        <button type="button" class="close" data-dismiss="alert">x</button>
        <strong>Ого! </strong>
        Вы удалили {{updatedAuto.name}}
    </div>
    <table id="autoTable" class="table table-hover" ng-if="allitems == 1"> 
    <!-- просмотр всех автомобилей -->                
        <tr class="sort-names">
            <th><a href="" ng-click="order('name')">Имя <i class="fa" ng-show="predicate === 'name'" ng-class="{'fa-sort-asc':!reverse, 'fa-sort-desc':reverse}"></i><i class="fa fa-sort" ng-show="predicate != 'name'" ></i></a></th>
            <th><a href="" ng-click="order('mark')">Марка <i class="fa" ng-show="predicate === 'mark'" ng-class="{'fa-sort-asc':!reverse, 'fa-sort-desc':reverse}"></i><i class="fa fa-sort" ng-show="predicate != 'mark'" ></i></a></th>
            <th><a href="" ng-click="order('model')">Модель <i class="fa" ng-show="predicate === 'model'" ng-class="{'fa-sort-asc':!reverse, 'fa-sort-desc':reverse}"></i><i class="fa fa-sort" ng-show="predicate != 'model'" ></i></a></th>
            <th><a href="" ng-click="order('year')">Год выпуска <i class="fa" ng-show="predicate === 'year'" ng-class="{'fa-sort-asc':!reverse, 'fa-sort-desc':reverse}"></i><i class="fa fa-sort" ng-show="predicate != 'year'" ></i></a></th>
            <th class="relative-wrap"> 
                <div class="absolute-wrap search-wrap">
                    <div class="input-group search-form input-group-xs">
                      <input type="text" class="form-control" ng-model="query" placeholder="Поиск">
                      <div class="input-group-addon"><i class="fa fa-search"></i></div>
                    </div>
                </div>
            </th>
        </tr>
        <tr ng-repeat="item in autos | filter:query |orderBy:predicate:reverse" >
            <td ng-click="viewItem(item,2)">{{item.name}}</td>
            <td ng-click="viewItem(item,2)">{{item.mark}}</td>
            <td ng-click="viewItem(item,2)">{{item.model}}</td>
            <td ng-click="viewItem(item,2)">{{item.year}}</td>
            <td class="active-buttons">
                <button ng-click="viewItem(item,2)" class="btn btn-xs btn-info" data-toggle="tooltip" title="Посмотреть">
                    <i class="fa fa-link"></i>
                </button>
                <button ng-click="editItem(item,3)" ng-disabled="item.replied" class="btn btn-xs btn-success" data-toggle="tooltip" title="Изменить">
                    <i class="fa fa-edit"></i>
                </button>
                <button ng-click="isdeleteAuto(item)" class="btn btn-xs btn-danger" data-toggle="tooltip" title="Удалить">
                    <i class="fa fa-remove"></i>
                </button>
            </td>
        </tr>
    </table>
    <div class="add-auto" ng-if="allitems == 1">
    <button ng-click="viewItem(null,3)" class="btn btn-sm btn-primary ">
        <i class="fa fa-plus fa-2x"></i> 
    </button>
    Добавить автомобиль
    </div>
        <div class="wrapper-part" ng-if="allitems == 2">
        <button ng-click="viewItem($parent.mainproduct, 1)" class="btn btn-xs btn-primary btn-icons"><i class="fa fa-arrow-left"></i></button>
            <div class="panel panel-info">
              <div class="panel-heading">
                <h2 class="panel-title">Данные автомобиля</h2>
              </div>
              <div class="row autodescription container-fluid">
                <div class="col-md-4"><label>Имя</label><div>{{$parent.mainproduct.name || 'нету'}}</div> </div>
                <div class="col-md-4"><label>Марка</label><div>{{$parent.mainproduct.mark || 'нету'}}</div> </div>
                <div class="col-md-4"><label>Модель</label><div>{{$parent.mainproduct.model || 'нету'}}</div> </div>
                <div class="col-md-4"><label>Поколение</label><div>{{$parent.mainproduct.generation || 'нету'}}</div> </div>
                <div class="col-md-4"><label>Год</label><div>{{$parent.mainproduct.year || 'нету'}}</div> </div>
                <div class="col-md-4"><label>Тип двигателя</label><div>{{$parent.mainproduct.engine || 'нету'}}</div> </div>
                <div class="col-md-4"><label>Коробка</label><div>{{$parent.mainproduct.box || 'нету'}}</div> </div>
                <div class="col-md-4"><label>Мощность</label><div>{{$parent.mainproduct.body || '0'}} л.с.</div> </div>
                <div class="col-md-4"><label>Объем двигателя</label><div>{{$parent.mainproduct.volume || '0'}} л.</div> </div>
                <div class="col-md-4"><label>Цвет</label><div>{{$parent.mainproduct.color || 'нету'}}</div> </div>
                <div class="col-md-4"><label>Привод</label><div>{{$parent.mainproduct.drive || 'нету'}}</div> </div>
                <div class="col-md-4"><label>Пробег</label><div>{{$parent.mainproduct.mileage || '0'}} км</div> </div>
                <div class="col-md-4"><label>Vin</label><div>{{$parent.mainproduct.vin || 'нету'}}</div> </div>
                <div class="col-md-12 text-center"><img data-ng-src="data:image/png;base64,{{$parent.mainproduct.picture.base64}}" data-err-src="avatar.png"/></div>
                </div>
            </div>
            </div>
    <div id="addTable"  class="wrapper-part" ng-if="allitems == 3">
    <!-- добавление одного автомобиля -->
    <button ng-click="viewItem($parent.mainproduct, 1)" class="btn btn-xs btn-primary btn-icons"><i class="fa fa-arrow-left"></i></button>
        <div class="panel panel-info">
            <div class="panel-heading">
                <h2 class="panel-title">Данные автомобиля</h2>
              </div>
            <div class="panel-body">
            
                <form name="autoadd" novalidate>
                    <div class="form-group">
                        <label>Название</label>
                        <input name="name" class="form-control" ng-model="$parent.mainproduct.name"/>
                    </div>
                    <div class="form-group">
                        <label>Марка</label>
                        <select id="mark" class="form-control" ng-if="!markinput && !$parent.mainproduct.ismark" ng-change="$parent.Search(1, $parent.mainproduct.mark)" ng-focus="marks['Другая']='dif'" ng-model="$parent.mainproduct.mark" ng-options="mark for (mark, models) in marks" >
                        <option value=''>Выбрать</option>
                        </select>
                        <input type="text" class="form-control" ng-model="$parent.mainproduct.mark" ng-if="markinput && $parent.mainproduct.ismark" ng-blur="BacktoSelect(1,$parent.mainproduct.mark)"/>
                    </div>
                    <div class="form-group">
                        <label>Модель</label>
                        <select id="model" class="form-control" ng-change="$parent.Search(2,$parent.mainproduct.model)" ng-if="!modelinput && !$parent.mainproduct.ismodel" ng-focus="$parent.mainproduct.mark['Другая'] ='dif'" ng-disabled="!$parent.mainproduct.mark" id="model" ng-model="$parent.mainproduct.model" ng-options="model for (model, generations) in $parent.mainproduct.mark"><option value=''>Выбрать</option></select>
                        <input type="text" class="form-control" ng-model="$parent.mainproduct.model"  ng-if="modelinput && $parent.mainproduct.ismodel" ng-blur="BacktoSelect(2,$parent.mainproduct.model)"/>
                    </div>
                    <div class="form-group">
                        <label>Поколение</label>
                        <select class="form-control" ng-change="Search(3,$parent.mainproduct.generation)" ng-if="!generationinput && !$parent.mainproduct.isgeneration" ng-focus="$parent.mainproduct.model.push('Другая');" ng-disabled="!$parent.mainproduct.mark || !$parent.mainproduct.model" id="generation" ng-model="$parent.mainproduct.generation" ng-options="generation for generation in $parent.mainproduct.model"><option value=''>Выбрать</option></select>
                        <input type="text" class="form-control" ng-model="$parent.mainproduct.generation" ng-if="generationinput && $parent.mainproduct.isgeneration" ng-blur="BacktoSelect(3,$parent.mainproduct.generation)"/>
                    </div>
                    <div class="form-group">
                        <label>Год</label>
                        <input name="name" class="form-control" ng-model="mainproduct.year"/>
                    </div>
                    <div class="form-group">
                        <label>Тип двигателя</label>
                        <input name="name" class="form-control" ng-model="$parent.mainproduct.engine"/>
                    </div>
                    <div class="form-group">
                        <label>Коробка передач</label>
                        <input name="name" class="form-control" ng-model="$parent.mainproduct.box"/>
                    </div>
                    <div class="form-group">
                        <label>Мощность</label>
                        <div class="input-group">
                            <input name="name" class="form-control" ng-model="$parent.mainproduct.body"/>
                            <div class="input-group-addon">л.с.</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Объем двигателя</label>
                        <div class="input-group">
                            <input name="name" class="form-control" ng-model="$parent.mainproduct.volume"/>
                            <div class="input-group-addon">л.</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Цвет</label>
                        <input name="name" class="form-control" ng-model="$parent.mainproduct.color"/>
                    </div>
                    <div class="form-group">
                        <label>Привод</label>
                        <input name="name" class="form-control" ng-model="$parent.mainproduct.drive"/>
                    </div>
                    <div class="form-group">
                        <label>Пробег</label>
                        <div class="input-group">
                        <input name="name" class="form-control" ng-model="$parent.mainproduct.mileage"/>
                            <div class="input-group-addon">км</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Vin</label>
                        <input name="name" class="form-control" ng-model="$parent.mainproduct.vin"/>
                    </div>
                    <div class="form-group">
                        <label>Фото</label>
                        <img style="max-width:100px;" ng-if="startEdit && $parent.mainproduct.newpicture == null" data-ng-src="data:image/png;base64,{{$parent.mainproduct.picture.base64}}" data-err-src="avatar.png"/>
                        <img style="max-width:100px;" ng-if="startEdit && $parent.mainproduct.newpicture != null" data-ng-src="data:image/png;base64,{{$parent.mainproduct.newpicture.base64}}" data-err-src="avatar.png"/>
                        <input ng-if="startEdit" name="name" type='file' ng-model='$parent.mainproduct.newpicture' base-sixty-four-input />
                        <input ng-if="!startEdit" name="name" type='file' ng-model='$parent.mainproduct.picture' base-sixty-four-input />
                    </div>
                     <div class="text-center bottom-button">
                    <button ng-if="!startEdit" ng-click="addItem($parent.mainproduct)" class="btn btn-primary">
                        Создать
                    </button>
                    <button ng-if="startEdit" ng-click="updateProduct($parent.mainproduct)" class="btn btn-primary">
                        Обновить
                    </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// <![CDATA[
/*$(document).ready(function() {
    var active="none";
    $("#"+active).show();
$(".model").append( $('<option value="Other">Другая</option>'));
$('#mark option').each(function(){
temp=$(this).val().split(':');
if (temp.length > 1){
$(this).val(temp[0]);
$(this).text(temp[1]);
}
});
    $('#mark').change(function() {
        $("#"+active).hide();
        active=$("#mark").val();
        $("#Different").hide();
        $("#"+active).show();
if($(this).val() == "Different"){
$(this).hide();
$("#Difmark").show();
}
    });
$('.model').change(function(){
if ($(this).val() == "Other"){
$(this).hide();
$("#Different").show();
}
});
$('select.model, .modelinput').change(function(){
document.getElementById('modelsum23').value = $(this).val();
$('#modelsum23').attr('value',$(this).val());
});
$('#Different').blur(function(){
if ($(this).val() == ''){
$(this).hide();
$("#"+active).show();
}
});
$('#Difmark').blur(function(){
if ($(this).val() == ''){
$(this).hide();
$("#mark").show();
}
});
});
// ]]> */</script>

