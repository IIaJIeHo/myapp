<style>
    #productTable { width: auto; }
    #productTable td { max-width: 150px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; }
    #productTable td input { max-width: 125px; }
</style>

<div ng-controller="autoCtrl">
    <div class="alert alert-success" id="alert" style="position:fixed;bottom:0;right:0;display:none;">
        <button type="button" class="close" data-dismiss="alert">x</button>
        <strong>Поздравляем! </strong>
        Вы добавили новый автомобиль
    </div>
    <div class="alert alert-success" id="a-auto-edit" style="position:fixed;bottom:0;right:0;display:none;">
        <button type="button" class="close" data-dismiss="alert">x</button>
        <strong>Поздравляем! </strong>
        Вы обновили {{updatedAuto.name}}
    </div>
    <div class="alert alert-danger" id="a-auto-delete" style="position:fixed;bottom:0;right:0;display:none;">
        <button type="button" class="close" data-dismiss="alert">x</button>
        <strong>Ого! </strong>
        Вы удалили {{updatedAuto.name}}
    </div>
    <table id="autoTable" class="table table-striped table-bordered" ng-if="allitems == 1"> 
    <!-- просмотр всех автомобилей -->
        <tr>
            <td>
                <button ng-click="viewItem(null,3)" class="btn btn-xs btn-primary">
                    Новый
                </button>
            </td>
        </tr>
        <tr>
            <th>Имя</th>
            <th>Марка</th>
            <th>Модель</th>
            <th>Поколение</th>
            <th><input type="text" ng-model="query" /></th>
        </tr>
        <tr ng-repeat="item in autos | filter:query" ng-hide="item.id == editedProduct.id" ng-click="viewItem(item,2)">
            <td>{{item.name}}</td>
            <td>{{item.mark}}</td>
            <td>{{item.model}}</td>
            <td>{{item.generation}}</td>
            <td>
                <button ng-click="viewItem(item,2)" class="btn btn-xs btn-info" data-toggle="tooltip" title="Посмотреть">
                    <span class="glyphicon glyphicon-hand-up" aria-hidden="true"></span>
                </button>
                <button ng-click="editItem(item,3)" ng-disabled="item.replied" class="btn btn-xs btn-success" data-toggle="tooltip" title="Изменить">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                </button>
                <button confirmed-click="deleteAuto(item)" ng-confirm-click="Вы действительно хотите удалить?" class="btn btn-xs btn-danger" data-toggle="tooltip" title="Удалить">
                    <span class="glyphicon glyphicon-thumbs-down" aria-hidden="true"></span>
                </button>
            </td>
        </tr>
    </table>
    <table id="singleTable" class="table table-striped table-bordered" ng-if="allitems == 2">
    <!-- просмотр одного автомобиля-->
        <tr>
            <th>Name</th>
            <th>Mark</th>
            <th>Model</th>
            <th>Generation</th>
            <th></th>
        </tr>
        <tr>
            <td>Имя: {{mainproduct.name}}</td>
            <td>Марка: {{mainproduct.mark}}</td>
            <td>Модель: {{mainproduct.model}}</td>
            <td>Поколение: {{mainproduct.generation}}</td>
            <td>
                <button ng-click="viewItem(mainproduct, 1)" class="btn btn-xs btn-primary">
                    Назад
                </button>
            </td>
        </tr>
        <tr>
            <td>Год: {{mainproduct.year}}</td>
            <td>Engine: {{mainproduct.engine}}</td>
            <td>Box: {{mainproduct.box}}</td>
            <td>Body: {{mainproduct.body}}</td>
            <td>Объем двигателя: {{mainproduct.volume}}</td>
        </tr>  
        <tr>
            <td>Цвет: {{mainproduct.color}}</td>
            <td>Drive: {{mainproduct.drive}}</td>
            <td>Пробег: {{mainproduct.mileage}}</td>
            <td>Vin: {{mainproduct.vin}}</td>
            <td><img data-ng-src="data:image/png;base64,{{mainproduct.picture.base64}}" data-err-src="avatar.png"/></td>
        </tr>      
    </table>
    <div id="addTable"  ng-if="allitems == 3">
    <!-- добавление одного автомобиля -->
        <div class="panel-body">
        <button ng-click="viewItem(mainproduct, 1)" class="btn btn-xs btn-primary">Назад</button>
            <form name="autoadd" novalidate>
                <div class="form-group">
                    <label>Название</label>
                    <input name="name" class="form-control" ng-model="mainproduct.name"/>
                </div>
                <div class="form-group">
                    <label>Марка</label>
                    <select id="mark" class="form-control" ng-if="!markinput" ng-change="Search(1, mainproduct.mark)" ng-focus="marks['other']=''" ng-model="mainproduct.mark" ng-options="mark for (mark, models) in marks" >
                    <option value=''>Select</option>
                    </select>
                    <input type="text" class="form-control" ng-model="mainproduct.mark" ng-if="markinput" ng-blur="BacktoSelect(1,mainproduct.mark)"/>
                </div>
                <div class="form-group">
                    <label>Модель</label>
                    <select id="model" class="form-control" ng-change="Search(2,mainproduct.model)" ng-if="!modelinput" ng-focus="mainproduct.mark['other'] =''" ng-disabled="!mainproduct.mark" id="model" ng-model="mainproduct.model" ng-options="model for (model, generations) in mainproduct.mark"><option value=''>Select</option></select>
                    <input type="text" class="form-control" ng-model="mainproduct.model"  ng-if="modelinput" ng-blur="BacktoSelect(2,mainproduct.model)"/>
                </div>
                <div class="form-group">
                    <label>Поколение</label>
                    <select class="form-control" ng-change="Search(3,mainproduct.generation)" ng-if="!generationinput" ng-focus="mainproduct.model.push('other');" ng-disabled="!mainproduct.mark || !mainproduct.model" id="generation" ng-model="mainproduct.generation" ng-options="generation for generation in mainproduct.model"><option value=''>Select</option></select><input type="text" class="form-control" ng-model="mainproduct.generation" ng-if="generationinput" ng-blur="BacktoSelect(3,mainproduct.generation)"/>
                </div>
                <div class="form-group">
                    <label>Год</label>
                    <input name="name" class="form-control" ng-model="mainproduct.year"/>
                </div>
                <div class="form-group">
                    <label>Двигатель</label>
                    <input name="name" class="form-control" ng-model="mainproduct.engine"/>
                </div>
                <div class="form-group">
                    <label>Коробка передач</label>
                    <input name="name" class="form-control" ng-model="mainproduct.box"/>
                </div>
                <div class="form-group">
                    <label>Body</label>
                    <input name="name" class="form-control" ng-model="mainproduct.body"/>
                </div>
                <div class="form-group">
                    <label>Объем двигателя</label>
                    <input name="name" class="form-control" ng-model="mainproduct.volume"/>
                </div>
                <div class="form-group">
                    <label>Цвет</label>
                    <input name="name" class="form-control" ng-model="mainproduct.color"/>
                </div>
                <div class="form-group">
                    <label>Драйв</label>
                    <input name="name" class="form-control" ng-model="mainproduct.drive"/>
                </div>
                <div class="form-group">
                    <label>Пробег</label>
                    <input name="name" class="form-control" ng-model="mainproduct.mileage"/>
                </div>
                <div class="form-group">
                    <label>Vin</label>
                    <input name="name" class="form-control" ng-model="mainproduct.vin"/>
                </div>
                <div class="form-group">
                    <label>Фото</label>
                    <input name="name" type='file' ng-model='mainproduct.picture' base-sixty-four-input />
                </div>
                <button ng-if="!startEdit" ng-click="addItem(mainproduct)" class="btn btn-xs btn-primary">
                    Создать
                </button>
                <button ng-if="startEdit" ng-click="updateProduct(mainproduct)" class="btn btn-xs btn-primary">
                    Обновить
                </button>
            </form>
        </div>
    </div>
</div>

<script>
// <![CDATA[
/*$(document).ready(function() {
    var active="none";
    $("#"+active).show();
$(".model").append( $('<option value="Other">Другая</option>'));
$('#mark option').each(function(){
temp=$(this).val().split(':');
if (temp.length > 1){
$(this).val(temp[0]);
$(this).text(temp[1]);
}
});
    $('#mark').change(function() {
        $("#"+active).hide();
        active=$("#mark").val();
        $("#Different").hide();
        $("#"+active).show();
if($(this).val() == "Different"){
$(this).hide();
$("#Difmark").show();
}
    });
$('.model').change(function(){
if ($(this).val() == "Other"){
$(this).hide();
$("#Different").show();
}
});
$('select.model, .modelinput').change(function(){
document.getElementById('modelsum23').value = $(this).val();
$('#modelsum23').attr('value',$(this).val());
});
$('#Different').blur(function(){
if ($(this).val() == ''){
$(this).hide();
$("#"+active).show();
}
});
$('#Difmark').blur(function(){
if ($(this).val() == ''){
$(this).hide();
$("#mark").show();
}
});
});
// ]]> */</script>

